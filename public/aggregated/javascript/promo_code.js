/************************************************************************
 * 'promo_code.js'
 *
 * This file is GENERATED by the AssetAggregator; do not edit it.
 * Last modified: 2016-07-14 01:06:05 +0000
 * Generated at: 2016-07-14 16:15:13 +0000
 ************************************************************************/


/************************************************************************
 * :asset_packager_compatibility, 'config/asset_packages.yml' (last modified: 2016-07-14 01:06:05 +0000)
 ************************************************************************/





/************************************************************************
 * :asset_packager_compatibility, 'config/asset_packages.yml' (last modified: 2016-07-14 01:06:05 +0000)
 ************************************************************************/





/************************************************************************
 * :files, 'public/javascripts/shared', ... (last modified: (none))
 ************************************************************************/





/************************************************************************
 * :files, 'app/views', ... (last modified: (none))
 ************************************************************************/





/************************************************************************
 * :files, 'app/views', ... (last modified: (none))
 ************************************************************************/





/************************************************************************
 * :class_inlines, 'app/views', ... (last modified: 2016-01-21 00:14:18 +0000)
 ************************************************************************/

/* ----------------------------------------------------------------------
   - app/views/promo_code/custom_promo.coffee (last modified: 2015-11-10 00:53:08 +0000)
   ---------------------------------------------------------------------- */
(function() {
  var bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Scribd.CustomPromo = (function() {
    function CustomPromo(container, opts) {
      this.container = container;
      this.opts = opts != null ? opts : {};
      this.submit = bind(this.submit, this);
      this.container = $(this.container);
      this.container.on("click", ".post_promo", (function(_this) {
        return function() {
          return _this.submit();
        };
      })(this));
    }

    CustomPromo.prototype.submit = function(callback) {
      return $.post("/promo_code/submit", {
        promo: this.opts.promo
      }, (function(_this) {
        return function(res) {
          var lb;
          if (typeof callback === "function") {
            callback(res);
          }
          if (res.valid && !Scribd.logged_in) {
            if (_this.opts.is_mobile) {
              return window.location.href = "/mobile/login?from=" + (encodeURIComponent(res.next_url));
            } else {
              lb = Scribd.Lightbox.open('signup_lb', Scribd.LoginLightbox, {
                no_redirect: false
              });
              lb.set_header("Join today");
              return lb.set_login_param('next_url', res.next_url);
            }
          } else if (res.flash) {
            return (new Scribd.Flasher()).show('error', res.flash);
          } else if (res.valid && res.next_url) {
            return window.location.href = res.next_url;
          }
        };
      })(this));
    };

    return CustomPromo;

  })();

}).call(this);


/* ----------------------------------------------------------------------
   - app/views/promo_code/show.coffee (last modified: 2016-01-21 00:14:18 +0000)
   ---------------------------------------------------------------------- */
(function() {
  Scribd.PromoCodePage = (function() {
    function PromoCodePage(container, opts) {
      this.container = container;
      this.opts = opts != null ? opts : {};
      this.container = $(this.container);
      this.$form = this.container.find('#promo-code-form');
      this.$error = this.container.find('.error_message');
      this.container.dispatch("click", {
        submit_promo: (function(_this) {
          return function(btn) {
            _this.$error.hide();
            return $.ajax({
              url: _this.$form.prop('action'),
              type: "POST",
              data: _this.$form.serialize(),
              success: function(res) {
                var lb;
                if (res.valid && !Scribd.logged_in) {
                  lb = Scribd.Lightbox.open('signup_lb', Scribd.LoginLightbox, {
                    no_redirect: false
                  });
                  lb.set_header("Join to Redeem Promo");
                  lb.set_login_param('next_url', res.next_url);
                  return $(".lightbox .trial_duration").text(Scribd.trial_duration_text(res.trial_days));
                } else if (!res.valid) {
                  return _this.$error.show();
                } else {
                  return window.location.href = res.next_url;
                }
              }
            });
          };
        })(this)
      });
      this.setupZenbox();
      this.container.find('.zenbox').click(this.showZenbox);
    }

    PromoCodePage.prototype.setupZenbox = function() {
      return typeof Zenbox !== "undefined" && Zenbox !== null ? Zenbox.init({
        dropboxID: "20274687",
        url: "https://scribd.zendesk.com",
        tabTooltip: "Ask Us",
        tabImageURL: "https://assets.zendesk.com/external/zenbox/images/tab_ask_us.png",
        tabColor: "black",
        tabPosition: "Left",
        hide_tab: "true",
        requester_name: this.opts.login,
        requester_email: this.opts.email
      }) : void 0;
    };

    PromoCodePage.prototype.showZenbox = function(e) {
      if (typeof Zenbox !== "undefined" && Zenbox !== null) {
        Zenbox.show();
      }
      return false;
    };

    return PromoCodePage;

  })();

}).call(this);




/************************************************************************
 * :class_inlines, 'spec_javascripts/js_spec', ... (last modified: (none))
 ************************************************************************/

